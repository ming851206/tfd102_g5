<!DOCTYPE html>
<html lang="zh_Hant">

<head>
    <title>旅遊結帳</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <!-- 共用 -->
    <meta charset="UTF-8">
    <meta name="keywords" content="travel, tour, trip, online travel">
    <meta name="description" content="online travel website">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./js/jq/jquery-3.6.0.js"></script>
    <script src="./js/vue/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-router/3.5.2/vue-router.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.js"></script>
    <link rel="icon" href="./images/logo/favicon.ico.png" type="image/x-icon">
    <link rel="stylesheet" href="./css/style.css">
</head>

<body class="travel_payment_Body">
    <header id="the_header">
        <the-header></the-header>
    </header>
    <div id="mobile_menu">
        <menu-item></menu-item>
    </div>
    <div class="mobile_logo">
        <img src="./images/logo/logo.svg" alt="logo">
    </div>
    <div id="travel_payment_page">
        <!--  include header   -->

        <!-- 確認並付款 -->
        <div class="payment_mainTitle">
            <div class="payment_mainTitle_icon">
                <img src="./images/icon/arrowLeft.svg" alt="" @click="hrefback" style="cursor: pointer;">
            </div>
            <h3 class="payment_mainTitle_h3">確認並付款</h2>
        </div>

        <!-- 你的旅遊資訊確認 -->
        <div class="mainTitle_info_confirmation_container">
            <div class="mainTitle_info_confirmation_left">
                <h4 class="mainTitle_info_confirmation_left_h4">你的旅遊</h4>
                <p class="mainTitle_info_confirmation_left_p">日期<br><span>{{showDate}}</span><span>{{showTime}}</span>
                </p>
            </div>

            <!-- <div class="mainTitle_info_confirmation_right">
                <h4 class="mainTitle_info_confirmation_right_h4">旅遊人數</h4>
                <div class="mainTitle_info_confirmation_right_people">
                    <div class="right_people_box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <path id="Icon_ionic-md-person" data-name="Icon ionic-md-person" d="M16.5,16.5a6,6,0,1,0-6-6A6.017,6.017,0,0,0,16.5,16.5Zm0,3c-3.975,0-12,2.025-12,6v3h24v-3C28.5,21.525,20.475,19.5,16.5,19.5Z" transform="translate(-4.5 -4.5)" fill="rgba(0,0,0,0.8)"/>
                        </svg>
                        <input class="right_people_box_input" type="text" placeholder="人數" id="">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16.604" height="10.723" viewBox="0 0 16.604 10.723">
                            <path id="Icon_awesome-angle-down" data-name="Icon awesome-angle-down" d="M7.421,21.1.362,14.039a1.241,1.241,0,0,1,0-1.76l1.173-1.173a1.241,1.241,0,0,1,1.76,0l5,5,5-5a1.241,1.241,0,0,1,1.76,0l1.173,1.173a1.241,1.241,0,0,1,0,1.76L9.176,21.1a1.234,1.234,0,0,1-1.754,0Z" transform="translate(0.004 -10.74)" fill="#996A4D"/>
                        </svg>
                    </div>
                </div>
                
            </div> -->
        </div>

        <!-- 購買資訊內容 -->
        <div class="payment_info_container">
            <!-- left -->
            <div class="payment_info_block_left">
                <div class="payment_info_block_left_upblock">
                    <div class="payment_info_block_left_img">
                        <img :src="product.avatar" alt="">
                        <p>{{product.name}}</p>
                    </div>
                    <div class="payment_info_block_left_title_area">
                        <div class="payment_info_block_left_title_area_star">
                            <svg xmlns="http://www.w3.org/2000/svg" width="13.814" height="13.222"
                                viewBox="0 0 13.814 13.222">
                                <path id="Icon_awesome-star" data-name="Icon awesome-star"
                                    d="M7.607.459,5.921,3.878l-3.772.55a.827.827,0,0,0-.457,1.41L4.421,8.5l-.646,3.757a.826.826,0,0,0,1.2.87L8.348,11.35l3.375,1.774a.826.826,0,0,0,1.2-.87L12.276,8.5,15,5.837a.827.827,0,0,0-.457-1.41l-3.772-.55L9.089.459a.827.827,0,0,0-1.482,0Z"
                                    transform="translate(-1.441 0.001)" fill="#996a4d" />
                            </svg>
                            <p><span>112</span> 則評價</p>
                        </div>
                        <h4>{{product.title}}</h4>
                    </div>

                </div>
                <div class="payment_info_line"></div>
                <div class="payment_info_priceBox">
                    <h4>價格詳情</h4>
                    <div class="item1_evt_price">
                        <p>場次單價
                            <span id="event_price">$ {{product.event_price}}</span><span id="people">&nbsp x
                                &nbsp{{showPeople}}人</span>
                        </p>
                        <p>${{personPrice}}</p>
                    </div>
                    <div class="item2_discount" v-if="isChk">
                        <p>優惠券</p>
                        <p>-${{coupon}}</p>
                    </div>
                    <div class="item3_total">
                        <p>總價(TWD)</p>
                        <p>${{totalPrice}}</p>
                    </div>
                </div>
                <p class="payment_info_block_left_remind">退訂政策 在旅遊活動開始「前 24 小時」取消，即可拿回全額退款。 </p>
            </div>

            <!-- right -->
            <div class="payment_info_block_right">
                <img :src="product.intro_pics" alt="">
            </div>
        </div>
        <!-- 輸入優惠卷 -->
        <div class="payment_discount_container">
            <h3>選擇優惠券：</h3>
            <div class="payment_discount">
                <div class="payment_add_discount">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40.5" height="27" viewBox="0 0 40.5 27">
                        <path id="Icon_awesome-ticket-alt" data-name="Icon awesome-ticket-alt"
                            d="M9,11.25H31.5v13.5H9ZM37.125,18A3.375,3.375,0,0,0,40.5,21.375v6.75A3.375,3.375,0,0,1,37.125,31.5H3.375A3.375,3.375,0,0,1,0,28.125v-6.75a3.375,3.375,0,0,0,0-6.75V7.875A3.375,3.375,0,0,1,3.375,4.5h33.75A3.375,3.375,0,0,1,40.5,7.875v6.75A3.375,3.375,0,0,0,37.125,18ZM33.75,10.688A1.687,1.687,0,0,0,32.063,9H8.438A1.687,1.687,0,0,0,6.75,10.688V25.313A1.687,1.687,0,0,0,8.438,27H32.063a1.687,1.687,0,0,0,1.688-1.687Z"
                            transform="translate(0 -4.5)" fill="rgba(0,0,0,0.8)" />
                    </svg>
                    <input type="text" name="" class="payment_add_discount_input" id="addDiscount" disabled
                        :value="addDiscount_value">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20.809" height="20.81" viewBox="0 0 20.809 20.81"
                        @click="discount_btn" style="cursor: pointer;">
                        <g id="Group_294" data-name="Group 294" transform="translate(-17900.5 -3663.095)">
                            <line id="Line_13" data-name="Line 13" x2="20.809" transform="translate(17900.5 3673.5)"
                                fill="none" stroke="#996A4D" stroke-width="4" />
                            <line id="Line_13-2" data-name="Line 13" y1="20.81"
                                transform="translate(17910.904 3663.095)" fill="none" stroke="#996A4D"
                                stroke-width="4" />
                        </g>
                    </svg>
                </div>
                <!-- 優惠卷下拉選單 -->
                <div class="payment_discount_list_block" v-if="discountShow">
                    <div class="payment_discount_list_block_input" @click="choose_discount">
                        <input class="payment_discount_list_input" type="text" :value="choose_discount_value" @input="alert('1111');
                            ">
                    </div>
                </div>
            </div>
        </div>

        <!-- 注意事項  -->
        <div class="notice_container">
            <div class="notice_h3">
                <h3>注意事項：</h3>
            </div>
            <div class="notice_p">
                <p>僅接受線上信用卡付款。<br>
                    參加者預訂要求，最多10人參加，年齡須滿18歲。</p>
            </div>
        </div>

        <!-- 確認並付款 -->
        <div class="pay_container">
            <div class="pay_container_h4">
                <h4>選擇以下按鈕即代表您同意參加者免責聲明、退訂政策和參加者退款政策。</h4>
            </div>
            <div class="payment_add_btn_block">
                <form method="POST" action="/php/createOrder.php">
                    <input type="hidden" :value="totalmoney" name="amt">
                    <input type="hidden" :value="this.product.event_price" name="evt_price">
                    <input type="hidden" :value="peopleNum" name="peopleNum">
                    <input type="hidden" :value="this.product.title" name="title">
                    <button type="submit" class="btnL" @click="payChk">確認並付款</button>
                </form>
                
            </div>
        </div>


    </div>
    <footer id="the_footer">
        <the-footer></the-footer>
    </footer>

    <script>
        
        new Vue({
            el: '#travel_payment_page',
            data() {
                return {
                    discountShow: false,
                    addcard_value: '輸入信用卡',
                    addDiscount_value: '選擇優惠券',
                    choose_discount_value: '跳轉世界玩翻天 75 折優惠',
                    successShow: false,
                    getdiscount: [],
                    product: [],
                    initPrice: 0,
                    couponMinus: 0,
                    totalmoney: 0,
                    peopleNum: sessionStorage.getItem('people_num'),
                    isChk: '',
                    resTxt: '',
                }
            },
            methods: {

                discount_btn() {
                    this.discountShow = !this.discountShow;
                },
                choose_discount() {
                    this.isChk = true;
                    this.addDiscount_value = this.choose_discount_value;
                    this.discountShow = !this.discountShow;
                },
                hrefback() {
                    location.href = 'travel_item.html';
                },
                payChk() {
                    
                    //insert訂單
                    axios.post('../../php/payment_insert.php', JSON.stringify({
                        session: sessionStorage.getItem('session_ID'),
                        people: sessionStorage.getItem('people_num'),
                        price: this.totalmoney,
                    }), {
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    }).then(res => { 
                        console.log(res);
                        sessionStorage.clear();
                    }).catch((error) => alert('數據加載失敗' + error));
                },
            },
            computed: {
                showDate() {
                    return sessionStorage.getItem('date');
                },
                showTime() {
                    return sessionStorage.getItem('time');
                },
                showPeople() {
                    return sessionStorage.getItem('people_num');
                },
                personPrice() {
                    let people = sessionStorage.getItem('people_num');
                    let price = this.product.event_price;
                    this.initPrice = people * price;
                    return this.initPrice
                },
                coupon() {
                    this.couponMinus = Math.floor(this.initPrice * 0.25);
                    return this.couponMinus;
                },
                totalPrice() {
                    this.totalmoney = this.initPrice - this.couponMinus;
                    return this.totalmoney;
                },
            },
            mounted() {
                axios.get('./php/payment_discount.php').then(res => {
                    let data = res.data;
                    this.getdiscount = data;
                })
                axios.get('./php/showTripitm.php', {
                    params: {
                        theID: sessionStorage.getItem('product_ID'),
                        //delTime: this.now
                    }
                }).then(res => {
                    this.product = res.data[0];
                    //console.log(this.product);
                }).catch((error) => alert('數據加載失敗' + error));
            },
        });

    </script>

    <script src="./js/header_footer.js"></script>
</body>